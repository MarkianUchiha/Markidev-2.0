---
// src/components/Exp.astro

// 1. Definir la estructura de datos para la experiencia
interface Experiencia {
  puesto: string;
  descripcion: string;
  skills: string[];
}

// 2. Crear un array con los datos de las experiencias
const experiencias: Experiencia[] = [
  {
    puesto: "EnarmDuo - Líder de Proyecto",
    descripcion: "Lideré el proyecto y a los equipos técnico, administrativo y de marketing, tomando decisiones de stack, creando el modelo de negocio y gerenciando el plan de Marketing.",
    skills: ["Liderazgo", "Planeación", "Organización", "Redes Sociales", "CEO", "UI/UX", "Flutter", "SQLite", "Firebase", "Google ADS"],
  },
  {
    puesto: "Suudai - Desarrollador Frontend",
    descripcion: "Desarrollé interfaces de usuario interactivas y responsivas utilizando tecnologías web modernas, colaborando estrechamente con el equipo de diseño, ademas de incorporar la seguridad y accesos al crm de la empresa.",
    skills: ["React", "TypeScript", "Tailwind CSS", "Figma", "Trabajo en Equipo", "Comunicación"],
  },
  {
    puesto: "Balanxa - IA Engenieer",
    descripcion: "Diseñé y mantuve las automatizaciones de atención al cliente y creación de contenido utilizando inteligencia artificial para optimizar procesos y maximizar ganancias a partir de tareas repetitivias.",
    skills: ["mongoDB", "Python", "OpenAI", "Gemini", "Docker", "AWS", "Resolución de Problemas", "Liderazgo", "Toma de Decisiones"],
  },
  {
    puesto: "Atumatizaciones - Ingeniero de Software",
    descripcion: "Diseñé y mantuve aplicaciones full-stack, optimizando el rendimiento de la base de datos y asegurando la escalabilidad del sistema.",
    skills: ["Node.js", "Express", "PostgreSQL", "Docker", "AWS", "Resolución de Problemas"],
  },
];
---

<section class="py-20 bg-gradient-to-bl from-[#19274e] to-[#220114]">
  <div class="container mx-auto px-4">
    <h2 class="text-4xl font-bold text-white text-center mb-12">Experiencia Profesional</h2>
    <div class="max-w-3xl mx-auto">
      {experiencias.map((exp) => (
        <div class="accordion-item border-b border-gray-700 last:border-b-0">
          <button class="accordion-header w-full text-left py-5 px-2 flex justify-between items-center text-white hover:bg-gray-800/50 transition-colors duration-300 focus:outline-none">
            <h3 class="text-xl font-semibold">{exp.puesto}</h3>
            <span class="accordion-icon text-2xl font-light transition-transform duration-300">+</span>
          </button>
          <div class="accordion-content overflow-hidden max-h-0 transition-all duration-500 ease-in-out">
            <div class="p-6 bg-gray-900/50">
              <p class="text-gray-300 mb-4">{exp.descripcion}</p>
              <div class="flex flex-wrap gap-2">
                {exp.skills.map(skill => (
                  <span class="bg-gray-700/60 text-gray-300 text-xs font-semibold px-2.5 py-0.5 rounded-full">{skill}</span>
                ))}
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const accordionItems = document.querySelectorAll('.accordion-item');

    // Guardamos las referencias a los elementos para no tener que buscarlos cada vez
    const accordionData = Array.from(accordionItems).map(item => {
      const header = item.querySelector('.accordion-header');
      const content = item.querySelector('.accordion-content');
      const icon = header ? header.querySelector('.accordion-icon') : null;
      return { item, header, content, icon };
    });

    accordionData.forEach(currentItem => {
      // Si falta algún elemento esencial, simplemente ignoramos este item para evitar errores
      if (!currentItem.header || !currentItem.content || !currentItem.icon) {
        console.warn('Advertencia: Un elemento del acordeón no tiene la estructura HTML esperada.');
        return;
      }

      currentItem.header.addEventListener('click', () => {
        const isOpen = currentItem.content.style.maxHeight && currentItem.content.style.maxHeight !== '0px';

        // Cerramos todos los acordeones
        accordionData.forEach(itemToClose => {
          if (itemToClose.content && itemToClose.header && itemToClose.icon) {
            itemToClose.content.style.maxHeight = '0px';
            itemToClose.header.classList.remove('is-open');
            itemToClose.icon.classList.remove('rotate-45');
          }
        });

        // Si no estaba abierto, lo abrimos
        if (!isOpen) {
          // Comprobación de seguridad adicional (redundante pero explícita)
          if (currentItem.content && currentItem.header && currentItem.icon) {
            currentItem.content.style.maxHeight = currentItem.content.scrollHeight + 'px';
            currentItem.header.classList.add('is-open');
            currentItem.icon.classList.add('rotate-45');
          }
        }
      });
    });
  });
</script>

<style>
  .accordion-header.is-open .accordion-icon {
    transform: rotate(45deg);
  }
  .accordion-content {
    max-height: 0;
    transition: max-height 0.5s cubic-bezier(0, 1, 0, 1);
  }
  .accordion-content[style*="max-height"]:not([style*="0px"]) {
    transition: max-height 0.5s cubic-bezier(1, 0, 1, 0);
  }
</style>
